import os
from tqdm.auto import tqdm

from VGG16 import VGG16


class MalwareClassification:
    def __init__(
        self,
        image_path,
        model_path,
        log_path,
        batch_size,
        learning_rate,
    ) -> None:
        print("Intializing Malware Classification.")

        self.vgg16 = VGG16(batch_size, learning_rate)
        self.image_path = image_path
        self.model_path = model_path
        self.log_path = log_path

        self.label_file = {}

    def setModel(self, train_ratio, pretrained: str = None):
        """
        Set model for malware classification.
        """
        print("Setting model for malware classification.")

        self.vgg16.loadData(self.image_path)
        self.vgg16.splitTrainData(train_ratio)
        self.vgg16.loadModel(pretrained)

    def trainModel(self, epochs):
        """
        Train the model.
        """
        print("Training the model.")

        train_acc, test_acc, train_loss, test_loss = self.vgg16.trainModel(
            epochs, self.model_path, self.log_path
        )
        print("Training accuracy: ", train_acc)
        print("Testing accuracy: ", test_acc)
        print("Training loss: ", train_loss)
        print("Testing loss: ", test_loss)

    def validateModel(self):
        """
        Validate the model.
        """
        print("Validating the model.")

        self.vgg16.setValidationData()
        self.vgg16.validateModel()
